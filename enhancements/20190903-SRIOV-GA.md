title: Graduate SR-IOV to GA
authors:
  - "@zshi"
  - "@pliu"
  - "@tohayash"
reviewers:
  - TBD
approvers:
  - TBD
creation-date: 2019-09-03
last-updated: 2019-09-03
status: implementable
see-also:
replaces:
superseded-by:
---

# Graduate SR-IOV to GA

## Release Signoff Checklist

- [x] Enhancement is `implementable`
- [ ] Design details are appropriately documented from clear requirements
- [ ] Test plan is defined
- [ ] Graduation criteria for dev preview, tech preview, GA
- [ ] User-facing documentation is created in [openshift/docs]

## Summary

A proposal to graduate SR-IOV support from Tech Preview to GA.

SR-IOV networks are enabled by Multus on secondary-onward pod interfaces.
It is supported as Tech Preview on OpenShift 4.1 and 4.2 releases.
This proposal is to make SR-IOV Generally Available in 4.3.

## Motivation

* SR-IOV is currently Technical Preview, but customers need to build supported
  solutions on the technology.

### Goals

- Support static IPAM
- Support default route overwrite
- Add admission controller for SR-IOV Network Operator
- Add SR-IOV Metrics and Alerting
- Support SR-IOV QoS flags
- Setup CI for SR-IOV testing
- Compare SR-IOV network performance w/wo NUMA affinity
- Full test coverage including upgrade test, negative test and performance test

### Non-Goals

- GA userspace (dpdk) workload support

## Proposal


### User Stories [optional]

#### Virtual Radio Access Networks

NFV vRAN workloads can run on OpenShift baremetal cluster.

### Implementation Details/Notes/Constraints [optional]

#### Static IPAM Plugin

Static IPAM plugin is used to assign IPv4 and IPv6 addresses statically to
container interface. It receives IPv4/v6 address configuration from CNI config
defined in network attachment definition custom resource or defined in
runtimeConfig injected by multus-cni, from pod annotation. This change also includes
runtimeConfig support in multus-cni.

##### Default Route Overwrite

Every pod comes with a default route. Currently cluster network CNI (i.e. 
openshift-sdn) adds default route and it is not possible to change this default
route to network attachment interface. This proposal is to come up with a
solution for Multus to handle default route overwriting.

##### DHCP Configuration Guide

DHCP IPAM plugin configuration is complicated due to its architecture,
for example, DHCP IPAM requires 'DHCP CNI daemon' and 'DHCP server'. Currently we
only provide simple document and we got several inquiry from user, hence
this proposal provides DHCP configuration guide to understand DHCP CNI configuration
and to help their troubleshooting.

##### Mac Address Pool Management

#### SR-IOV Operator

#### SR-IOV QoS Flags

Enable VF flags in the OpenShift Multus SR-IOV implementation for security
and QoS features.

- Spoof Check
- Trusted VF
- Max rate limit
- Min rate limit

SR-IOV CNI is able to accept above options as CNI config parameter
and configure VF device via netlink.

SR-IOV Operator will need to change API data structure to add above options
in `SriovNetwork` CRD.

### Risks and Mitigations

## Design Details

### Test Plan

- Tests will not be conducted against real PTP grandmaster clock
- Functional tests will be implemented

### Graduation Criteria

#### Tech Preview -> GA

- Have an opeartor to manage PTP CRDs

### Upgrade / Downgrade Strategy

### Version Skew Strategy

PTP runs as a separate DaemonSet.

## Implementation History
Version 4.1

Tech Preview

Version 4.2

Tech Preview

Version 4.3

GA

## Infrastructure Needed [optional]

